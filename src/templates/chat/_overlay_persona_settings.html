<!-- Character Settings Overlay -->
<div id="character-settings-overlay" class="overlay hidden">
    <div class="overlay-content char-config-content">
        <div class="overlay-header">
            <h2>Persona Einstellungen</h2>
            <button class="close-btn" id="close-settings">&times;</button>
        </div>
        <div class="overlay-body">
            
            <!-- ===== PERSONA LIST VIEW (Kontaktliste) ===== -->
            <div id="persona-list-view">
                <div class="persona-list-header">
                    <h3>Meine Personas</h3>
                    <button class="btn btn-specs-highlight" id="open-custom-specs-btn">
                        <span class="specs-icon">✦</span> Custom Specs
                    </button>
                </div>
                <div class="persona-contact-list" id="persona-grid">
                    <!-- Wird dynamisch befüllt -->
                </div>
                <!-- + Button am Ende der Liste -->
                <div class="persona-add-row" id="open-persona-creator-btn" title="Neue Persona erstellen">
                    <div class="persona-add-circle">+</div>
                    <span class="persona-add-label">Neue Persona erstellen</span>
                </div>
            </div>

            <!-- ===== PERSONA CREATOR / EDITOR VIEW ===== -->
            <div id="persona-creator-view" class="hidden">
                <div class="persona-creator-header">
                    <button class="btn btn-back" id="back-to-persona-list">← Zurück</button>
                    <h3 id="persona-editor-title">Persona Creator</h3>
                </div>

                <!-- Scrollbare Konfiguration -->
                <div class="persona-creator-layout">
                    <div class="persona-creator-form">
                        <!-- Avatar Section -->
                        <div class="config-section config-section-avatar">
                            <h3>Avatar</h3>
                            <div class="config-description">Wähle ein Bild für deine Persona:</div>
                            <div class="creator-avatar-area">
                                <div class="creator-avatar-preview" id="creator-avatar-preview">
                                    <span class="avatar-placeholder-text">Kein Avatar</span>
                                </div>
                                <button class="btn btn-secondary" id="creator-change-avatar-btn">Avatar auswählen</button>
                            </div>
                        </div>

                        <!-- Persona Info Section -->
                        <div class="config-section config-section-name">
                            <h3>Persona Info</h3>
                            <div class="persona-info-grid">
                                <div class="persona-info-field">
                                    <label class="config-description" for="persona-name-input">Name:</label>
                                    <input type="text" id="persona-name-input" class="form-input" placeholder="z.B. Ayame" value="">
                                </div>
                                <div class="persona-info-field">
                                    <label class="config-description" for="persona-age-input">Alter: <span id="persona-age-value">18</span></label>
                                    <input type="range" id="persona-age-input" class="slider persona-slider" min="18" max="99" value="18">
                                </div>
                                <div class="persona-info-field persona-info-field-full">
                                    <label class="config-description">Geschlecht:</label>
                                    <div class="gender-selector">
                                        <label class="radio-option">
                                            <input type="radio" name="persona-gender" value="männlich">
                                            <span>Männlich</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="persona-gender" value="weiblich" checked>
                                            <span>Weiblich</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="persona-gender" value="divers">
                                            <span>Divers</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Persona Type Section -->
                        <div class="config-section config-section-persona-type">
                            <h3>Persona</h3>
                            <div class="config-description">Art der Persona:</div>
                            <div class="persona-type-selector" id="persona-type-selector">
                                <!-- Dynamisch aus persona_spec geladen -->
                            </div>
                        </div>

                        <!-- Scenario Section (nur sichtbar wenn NICHT KI) -->
                        <div class="config-section config-section-scenario scenario-slide" id="scenario-section">
                            <h3>Szenario</h3>
                            <div class="config-description">Wähle ein oder mehrere Settings (kombinierbar):</div>
                            <div class="tags-available" id="scenario-available"></div>
                            <div class="tags-active-container">
                                <h4>Aktiv (<span id="scenario-count">0</span>):</h4>
                                <div class="tags-active" id="scenario-active"></div>
                            </div>
                        </div>

                        <!-- Core Traits Section -->
                        <div class="config-section config-section-traits">
                            <h3>Core Traits</h3>
                            <div class="config-description">Wähle Persönlichkeitsmerkmale:</div>
                            <div class="tags-available" id="traits-available"></div>
                            <div class="tags-active-container">
                                <h4>Aktiv (<span id="traits-count">0</span>):</h4>
                                <div class="tags-active" id="traits-active"></div>
                            </div>
                        </div>

                        <!-- Knowledge Section -->
                        <div class="config-section config-section-knowledge">
                            <h3>Knowledge</h3>
                            <div class="config-description">Wähle Wissensgebiete:</div>
                            <div class="tags-available" id="knowledge-available"></div>
                            <div class="tags-active-container">
                                <h4>Aktiv (<span id="knowledge-count">0</span>):</h4>
                                <div class="tags-active" id="knowledge-active"></div>
                            </div>
                        </div>

                        <!-- Expression Section -->
                        <div class="config-section config-section-expression">
                            <h3>Expression</h3>
                            <div class="config-description">Wähle einen Schreibstil:</div>
                            <div class="tags-available" id="expression-available"></div>
                            <div class="tags-active-container">
                                <h4>Aktiv:</h4>
                                <div class="tags-active" id="expression-active"></div>
                            </div>
                        </div>

                        <!-- Background Section -->
                        <div class="config-section config-section-background">
                            <h3>Background</h3>
                            <div class="config-description">Hintergrundgeschichte der Persona (optional):</div>
                            <div class="background-input-area">
                                <textarea id="persona-background-input" class="form-textarea" 
                                    placeholder="Beschreibe die Hintergrundgeschichte deiner Persona oder nutze Auto-Fill..." 
                                    maxlength="1500" rows="4"></textarea>
                                <div class="background-footer">
                                    <span class="char-counter"><span id="background-char-count">0</span> / 1500</span>
                                    <button class="btn btn-secondary btn-sm" id="background-autofill-btn" title="KI generiert eine Hintergrundgeschichte basierend auf den Persona-Einstellungen">✨ Auto-Fill</button>
                                </div>
                            </div>
                        </div>

                        <!-- First Message Section -->
                        <div class="config-section config-section-first-message">
                            <h3>First Message</h3>
                            <div class="first-message-toggle">
                                <label class="switch-label" for="start-msg-toggle">
                                    <span class="switch-container">
                                        <input type="checkbox" id="start-msg-toggle" class="switch-input">
                                        <span class="switch-slider"></span>
                                    </span>
                                    <span class="switch-text">First Message aktivieren</span>
                                </label>
                                <div class="config-hint">Die First Message wird in jeder neuen Session als erste Nachricht der Persona gesendet, sodass das Gespräch immer auf dieser Sequenz aufbaut.</div>
                            </div>
                            <div id="start-msg-input-area" class="start-msg-input-area hidden">
                                <textarea id="persona-start-msg-input" class="form-textarea" 
                                    placeholder="z.B. *lächelt freundlich* Hey! Schön dich zu sehen..." 
                                    maxlength="1000" rows="3"></textarea>
                                <div class="start-msg-footer">
                                    <span class="char-counter"><span id="start-msg-char-count">0</span> / 1000</span>
                                    <span class="config-hint-inline">Für nonverbale Formatierung RAW verwenden (z.B. *Aktion*)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="persona-creator-footer">
                    <button class="btn btn-secondary" id="reset-character-btn">Reset</button>
                    <button class="btn btn-primary" id="save-character-btn">Persona speichern</button>
                </div>
            </div>

        </div>
    </div>
</div>
