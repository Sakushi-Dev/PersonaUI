<!-- Header (fixed oben) -->
<header class="chat-header">
    <div class="header-content">
        <div class="header-left">
            <div class="character-info">
                <div class="character-avatar" id="character-avatar-display"
                     {% if character.avatar %}
                     {% set avatar_path = '/static/images/custom/' + character.avatar if character.get('avatar_type') == 'custom' else '/static/images/avatars/' + character.avatar %}
                     style="background-image: url('{{ avatar_path }}'); 
                            background-size: cover; 
                            background-position: center; 
                            background-repeat: no-repeat;"
                     {% endif %}>
                    {% if not character.avatar %}
                    <span class="avatar-placeholder">{{ character.char_name[0] }}</span>
                    {% endif %}
                </div>
                <h2 class="character-name">{{ character.char_name }}</h2>
            </div>
        </div>
        <div class="header-center">
            <div class="logo">PERSONA UI</div>
        </div>
        <div class="header-actions">
            <!-- Memory Button -->
            <button class="memory-btn disabled" id="memory-btn" title="Erinnerung erstellen (ab 3 Nachrichten)">
                Erinnern
            </button>
            
            <!-- Notification Sound Toggle -->
            <button class="sound-toggle-btn" id="sound-toggle-btn" title="Benachrichtigungston an/aus">
                <svg class="sound-icon sound-on" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                </svg>
                <svg class="sound-icon sound-off hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                    <line x1="23" y1="9" x2="17" y2="15"/>
                    <line x1="17" y1="9" x2="23" y2="15"/>
                </svg>
            </button>
            
            <!-- QR Code Button -->
            <button class="qr-code-btn" id="qr-code-btn" title="QR-Code & Netzwerk-Adressen">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                    <rect x="5" y="5" width="3" height="3" fill="currentColor"/>
                    <rect x="16" y="5" width="3" height="3" fill="currentColor"/>
                    <rect x="5" y="16" width="3" height="3" fill="currentColor"/>
                    <rect x="14" y="14" width="3" height="3" fill="currentColor"/>
                    <rect x="18" y="14" width="3" height="3" fill="currentColor"/>
                    <rect x="14" y="18" width="3" height="3" fill="currentColor"/>
                </svg>
            </button>
            
            <!-- API Status Indicator -->
            <div class="api-status-indicator" id="api-status-indicator" title="Lädt...">
                <span class="status-dot"></span>
            </div>
            
            <div class="dropdown">
                <button class="dropdown-toggle" id="settings-dropdown" title="Einstellungen">☰</button>
                <div class="dropdown-menu" id="settings-menu">
                    <button class="dropdown-item" id="user-profile-btn">
                        Mein Profil
                    </button>
                    <button class="dropdown-item" id="api-key-btn">
                        Set API-Key
                    </button>
                    <button class="dropdown-item" id="memory-settings-btn">
                        Erinnerungen
                    </button>
                    <button class="dropdown-item" id="edit-character-btn">
                        Persona
                    </button>
                    <button class="dropdown-item dropdown-submenu-toggle" id="settings-submenu-toggle">
                        Einstellungen
                        <span class="submenu-arrow">›</span>
                    </button>
                    <div class="dropdown-submenu" id="settings-submenu">
                        <button class="dropdown-item dropdown-subitem" id="interface-settings-btn">
                            Interface
                        </button>
                        <button class="dropdown-item dropdown-subitem" id="api-settings-btn">
                            API / Chat
                        </button>
                        <button class="dropdown-item dropdown-subitem" id="server-settings-btn">
                            Server
                        </button>
                        <button class="dropdown-item dropdown-subitem" id="access-control-btn">
                            Zugangskontrolle
                        </button>
                        <!--<button class="dropdown-item dropdown-subitem" id="debug-panel-btn">
                            Debug Panel
                        </button>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
